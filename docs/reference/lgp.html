<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Main function of the lgpr package — lgp • lgpr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Main function of the lgpr package — lgp" />
<meta property="og:description" content="Creates a model by calling create_model and fits by calling
sample_model." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgpr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/lgpr-package.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../tutorials/basic.html">Basic usage</a>
    </li>
    <li>
      <a href="../tutorials/heter.html">Heterogeneous effects</a>
    </li>
    <li>
      <a href="../tutorials/uncrt.html">Temporally uncertain effects</a>
    </li>
    <li>
      <a href="../tutorials/bb.html">Discrete observation model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Main function of the lgpr package</h1>
    <small class="dont-index">Source: <a href='https://github.com/jtimonen/lgpr/blob/master/R/lgpr.R'><code>R/lgpr.R</code></a></small>
    <div class="hidden name"><code>lgp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates a model by calling <code><a href='create_model.html'>create_model</a></code> and fits by calling
<code><a href='sample_model.html'>sample_model</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>lgp</span>(
  <span class='kw'>formula</span>,
  <span class='kw'>data</span>,
  likelihood = <span class='st'>"gaussian"</span>,
  prior = <span class='kw'>NULL</span>,
  c_hat = <span class='kw'>NULL</span>,
  num_trials = <span class='kw'>NULL</span>,
  options = <span class='kw'>NULL</span>,
  prior_only = <span class='fl'>FALSE</span>,
  verbose = <span class='fl'>FALSE</span>,
  sample_f = <span class='op'>!</span>(<span class='kw'>likelihood</span> <span class='op'>==</span> <span class='st'>"gaussian"</span>),
  <span class='kw'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>The model formula, where</p><ul>
<li><p>it must contain exatly one tilde (<code><a href='https://rdrr.io/r/base/tilde.html'>~</a></code>), with response
  variable on the left-hand side and model terms on the right-hand side</p></li>
<li><p>terms are be separated by a plus (<code><a href='https://rdrr.io/r/base/Arithmetic.html'>+</a></code>) sign</p></li>
<li><p>all variables appearing in <code>formula</code> must be
  found in <code>data</code></p></li>
</ul><p>See the "Model formula syntax" section below (<code>lgp</code>) for
instructions on how to specify the model terms.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A <code>data.frame</code> where each column corresponds to one
variable, and each row is one observation. Continuous covariates and the
response variable must have type <code>"numeric"</code> and categorical covariates
must have type <code>"factor"</code>. Missing values should be indicated with
<code>NaN</code> or <code>NA</code>. The response variable cannot contain missing
values. Column names should not contain trailing or leading underscores.</p></td>
    </tr>
    <tr>
      <th>likelihood</th>
      <td><p>Determines the observation model. Must be either
<code>"gaussian"</code> (default), <code>"poisson"</code>, <code>"nb"</code> (negative
binomial), <code>"binomial"</code> or <code>"bb"</code> (beta binomial).</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>A named list, defining the prior distribution of model
(hyper)parameters. See the "Defining priors" section below
(<code>lgp</code>).</p></td>
    </tr>
    <tr>
      <th>c_hat</th>
      <td><p>The GP mean. Must be a vector of length <code>dim(data)[1]</code>, or
a real number defining a constant GP mean. If not specified, this is set to</p><ul>
<li><p><code>c_hat = 0</code>, if <code>likelihood</code> is <code>"gaussian"</code>,</p></li>
<li><p><code>c_hat = </code> <code><a href='https://rdrr.io/r/base/Log.html'>log(mean(y))</a></code> if <code>likelihood</code> is
   <code>"poisson"</code> or <code>"nb"</code>,</p></li>
<li><p><code>c_hat = </code> <code><a href='https://rdrr.io/r/base/Log.html'>log(p/(1-p))</a></code>, where
   <code>p = mean(y/num_trials)</code> if <code>likelihood</code> is <code>"binomial"</code>
   or <code>"bb"</code>,</p></li>
</ul><p>where <code>y</code> denotes the response variable.</p></td>
    </tr>
    <tr>
      <th>num_trials</th>
      <td><p>This argument (number of trials) is only needed when
likelihood is <code>"binomial"</code> or <code>"bb"</code>. Must have length one or
equal to the number of data points. Setting <code>num_trials=1</code> and
<code>likelihood="binomial"</code> corresponds to Bernoulli observation model.</p></td>
    </tr>
    <tr>
      <th>options</th>
      <td><p>A named list with the following possible fields:</p><ul>
<li><p><code>delta</code> Amount of added jitter to ensure positive definite
  covariance matrices.</p></li>
<li><p><code>do_yrng</code> Should random numbers be drawn from the predictive
  distribution (one for each posterior draw). This can be set to true
  in order to do prior or posterior predictive sampling, and only has
  any effect if <code>sample_f = TRUE</code>.</p></li>
</ul><p>If <code>options</code> is <code>NULL</code>, default options are used. The defaults
are equivalent to <code>options = list(delta = 1e-8, do_yrng = FALSE)</code>.</p></td>
    </tr>
    <tr>
      <th>prior_only</th>
      <td><p>Should sampling be done in prior mode,
where likelihood is ignored? This can be used to do prior predictive
sampling, with <code>options = list(do_yrng = TRUE)</code> and
<code>sample_f = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Should more verbose output be printed?</p></td>
    </tr>
    <tr>
      <th>sample_f</th>
      <td><p>Determines if the latent function values are be sampled
(must be <code>TRUE</code> if likelihood is not <code>"gaussian"</code>). If this is
<code>TRUE</code>, the response variable will be normalized to have zero mean
and unit variance.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Optional arguments passed to
<code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>sampling</a></code> or <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-optimizing.html'>optimizing</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns an object of the S4 class <a href='lgpfit-class.html'>lgpfit</a>.</p>
    <h2 class="hasAnchor" id="model-formula-syntax"><a class="anchor" href="#model-formula-syntax"></a>Model formula syntax</h2>

    

<p>There are two ways to define the model formula:</p><ol>
<li><p>Using a common <code><a href='https://rdrr.io/r/stats/formula.html'>formula</a></code>-like syntax, like in
  <code>y ~ age +</code> <code>age|id</code> <code> + sex</code>. Terms can consist of a
  single variable, such as <code>age</code>, or an interaction of two variables,
  such as <code>age|id</code>. In single-variable terms, the variable can be either
  continuous (numeric) or categorical (factor), whereas in interaction terms
  the variable on the left-hand side of the vertical bar (<code><a href='https://rdrr.io/r/base/Logic.html'>|</a></code>) has to
  be continuous and the one on the right-hand side has to be categorical.
  Formulae specified using this syntax are translated to the advanced format
  so that</p><ul>
<li><p>single-variable terms become <code>gp(x)</code> if
    variable <code>x</code> is numeric and <code>zs(x)</code> if <code>x</code> is a factor</p></li>
<li><p>interaction terms <code>x|z</code> become <code>gp(x)*zs(z)</code></p></li>
</ul></li>
<li><p>Using the advanced syntax, like in <code>y ~ gp(age) +</code>
  <code>gp(age)*zs(id) +</code> <code>het(id)*gp_vm(disAge)</code>.
  This creates <a href='lgprhs-class.html'>lgprhs</a> objects, which consist of
 <a href='lgpterm-class.html'>lgpterm</a>s, which consist of <a href='lgpexpr-class.html'>lgpexpr</a>s.
 This approach must be used if creating nonstationary, heterogeneous or
 temporally uncertain components.</p></li>
</ol><p>Either one of the approaches should be used and they should not be mixed.</p>
    <h2 class="hasAnchor" id="defining-priors"><a class="anchor" href="#defining-priors"></a>Defining priors</h2>

    

<p>The <code>priors</code> argument must be a named list, like
<code><a href='https://rdrr.io/r/base/list.html'>list(alpha=student_t(4), wrp=igam(30,10))</a></code>. See examples in tutorials.
Possible allowed names are</p><ul>
<li><p><code>"alpha"</code> = component magnitude parameters</p></li>
<li><p><code>"ell"</code> = component lengthscale parameters</p></li>
<li><p><code>"wrp"</code> = input warping steepness parameters</p></li>
<li><p><code>"sigma"</code> = noise magnitude (Gaussian obs. model)</p></li>
<li><p><code>"phi"</code> = inv. overdispersion (negative binomial obs. model)</p></li>
<li><p><code>"gamma"</code> = overdispersion (beta-binomial obs. model)</p></li>
<li><p><code>"beta"</code> = heterogeneity parameters</p></li>
<li><p><code>"effect_time"</code> = uncertain effect time parameters</p></li>
<li><p><code>"effect_time_info"</code> = additional options for the above</p></li>
</ul><p>See <code><a href='priors.html'>priors</a></code> for functions that can be
used to define the list elements. If a parameter of a model is not given
in this list, a default prior will be used for it.</p>
    <h2 class="hasAnchor" id="when-to-not-use-default-priors"><a class="anchor" href="#when-to-not-use-default-priors"></a>When to not use default priors</h2>

    


<p>It is not recommended to use default priors blindly. Rather, priors should
be specified according to the knowledge about the problem at hand, as in any
Bayesian analysis. In <code>lgpr</code> this is especially important when</p><ol>
<li><p>Using a non-Gaussian likelihood or otherwise setting
 <code>sample_f = TRUE</code>. In this case the response variable is not
 normalized, so the scale on which the data varies must be taken into
 account when defining priors of the signal magnitude parameters
 <code>alpha</code> and possible noise parameters (<code>sigma</code>, <code>phi</code>,
 <code>gamma</code>). Also it should be checked if <code>c_hat</code> is set in a
 sensible way.</p></li>
<li><p>Using a model that contains a <code>gp_ns(x)</code> or <code>gp_vm(x)</code>
 expression in its formula. In this case the corresponding covariate
 <code>x</code> is not normalized, and the prior for the input warping steepness
 parameter <code>wrp</code> must be set according to the expected width of the
 window in which the nonstationary effect of <code>x</code> occurs. By default,
 the width of this window is about 36, which has been set assuming that
 the unit of <code>x</code> is months.</p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other main functions: 
<code><a href='create_model.html'>create_model</a>()</code>,
<code><a href='sample_model.html'>sample_model</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Juho Timonen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


