<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathematical description of lgpr models • lgpr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Mathematical description of lgpr models">
<meta property="og:description" content="lgpr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgpr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/lgpr-package.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../tutorials/basic.html">Basic usage</a>
    </li>
    <li>
      <a href="../tutorials/heter.html">Heterogeneous effects</a>
    </li>
    <li>
      <a href="../tutorials/uncrt.html">Temporally uncertain effects</a>
    </li>
    <li>
      <a href="../tutorials/bb.html">Discrete observation model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/math.html">Mathematical description of lgpr models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mathematical description of lgpr models</h1>
                        <h4 data-toc-skip class="author">Juho
Timonen</h4>
            
            <h4 data-toc-skip class="date">11th August 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jtimonen/lgpr/blob/HEAD/vignettes/math.Rmd" class="external-link"><code>vignettes/math.Rmd</code></a></small>
      <div class="hidden name"><code>math.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jtimonen/lgpr" class="external-link">lgpr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Attached lgpr 1.2.3, using rstan 2.21.8. Type ?lgpr to get started.</span></span></code></pre></div>
<p>This vignette describes mathematically the statistical models of
<code>lgpr</code>. We study the different arguments of the
<code><a href="../reference/lgp.html">lgp()</a></code> or <code><a href="../reference/create_model.html">create_model()</a></code> modeling functions and
what parts of the probabilistic model they customize. This is a concise
description, and the original publication (<span class="citation">Timonen et al. (2021)</span>) has more information
about the actual motivation for the used modeling approaches, and the <a href="https://jtimonen.github.io/lgpr-usage/" class="external-link">tutorials</a> have code
examples.</p>
<div class="section level2">
<h2 id="bayesian-gp-regression">1. Bayesian GP regression<a class="anchor" aria-label="anchor" href="#bayesian-gp-regression"></a>
</h2>
<p>The models in <code>lgpr</code> are models for the conditional
distribution <span class="math display">\[
p(y \mid f(\textbf{x}), \theta_{\text{obs}}),
\]</span> of response variable <span class="math inline">\(y\)</span>
given covariates <span class="math inline">\(\textbf{x}\)</span>, where
<span class="math inline">\(\theta_{\text{obs}}\)</span> is a possible
parameter of the observation model (like the magnitude of observation
noise). The function <span class="math inline">\(f\)</span> has a
Gaussian Process (GP) prior <span class="math display">\[
f \sim \mathcal{GP}(0, k\left(\textbf{x}, \textbf{x}' \mid
\theta_{\text{GP}})\right),
\]</span></p>
<p>with covariance (kernel) function <span class="math inline">\(k(\textbf{x}, \textbf{x}' \mid
\theta_{\text{GP}})\)</span> that has hyperparameters <span class="math inline">\(\theta_{\text{GP}}\)</span>. In addition to the GP
prior for <span class="math inline">\(f\)</span>, there is a parameter
prior distribution <span class="math inline">\(p(\theta)\)</span> for
<span class="math inline">\(\theta = \left\{ \theta_{\text{GP}},
\theta_{\text{obs}} \right\}\)</span>. Given <span class="math inline">\(N\)</span> observations <span class="math inline">\(\mathcal{D} = \{y_n,
\textbf{x}_n\}_{n=1}^N\)</span> the probabilistic models in
<code>lgpr</code> have the form <span class="math display">\[\begin{align}
p\left(\theta, \textbf{f}\right) &amp;= p\left(\textbf{f} \mid
\theta\right) \cdot p(\theta) &amp; \text{(prior)} \\
p(\textbf{y} \mid \textbf{f}, \theta) &amp;= \prod_{n=1}^N p(y_n \mid
f(\textbf{x}_n), \theta_{\text{obs}}) &amp; \text{(likelihood)},
\end{align}\]</span> where <span class="math inline">\(\textbf{f} =
\left[ f(\textbf{x}_1), \ldots, f(\textbf{x}_N) \right]^{\top}\)</span>,
<span class="math inline">\(\textbf{y} = \left[y_1, \ldots,
y_N\right]^{\top}\)</span>. The parameter prior density <span class="math inline">\(p(\theta)\)</span> is the product of the prior
densities of each parameter, and the GP prior means that the prior for
<span class="math inline">\(\textbf{f}\)</span> is the multivariate
normal <span class="math display">\[\begin{equation}
p\left(\textbf{f} \mid \theta\right) = \mathcal{N}\left(\textbf{f} \mid
\textbf{0}, \textbf{K} \right),
\end{equation}\]</span> where the <span class="math inline">\(N \times
N\)</span> matrix <span class="math inline">\(\textbf{K}\)</span> has
entries <span class="math inline">\(\{ \textbf{K} \}_{in} =
k(\textbf{x}_i, \textbf{x}_n \mid \theta_{\text{GP}})\)</span>.</p>
</div>
<div class="section level2">
<h2 id="connection-between-lgpr-arguments-and-different-model-parts">2. Connection between lgpr arguments and different model parts<a class="anchor" aria-label="anchor" href="#connection-between-lgpr-arguments-and-different-model-parts"></a>
</h2>
<p>The below table shows which parts of the above mathematical
description are affected by which arguments to <code><a href="../reference/lgp.html">lgp()</a></code> or
<code><a href="../reference/create_model.html">create_model()</a></code>. You can read more about them in the
documentation of said functions.</p>
<table class="table">
<thead><tr class="header">
<th>Argument</th>
<th>Affected model part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>formula</code></td>
<td><span class="math inline">\(k(\textbf{x},
\textbf{x}')\)</span></td>
</tr>
<tr class="even">
<td><code>data</code></td>
<td><span class="math inline">\(\mathcal{D}\)</span></td>
</tr>
<tr class="odd">
<td><code>likelihood</code></td>
<td><span class="math inline">\(p(y_n \mid f(\textbf{x}_n),
\theta_{\text{obs}})\)</span></td>
</tr>
<tr class="even">
<td><code>prior</code></td>
<td><span class="math inline">\(p(\theta)\)</span></td>
</tr>
<tr class="odd">
<td><code>c_hat</code></td>
<td><span class="math inline">\(p(y_n \mid f(\textbf{x}_n),
\theta_{\text{obs}})\)</span></td>
</tr>
<tr class="even">
<td><code>num_trials</code></td>
<td><span class="math inline">\(\mathcal{D}\)</span></td>
</tr>
<tr class="odd">
<td><code>options</code></td>
<td><span class="math inline">\(k(\textbf{x},
\textbf{x}')\)</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="the-likelihood-argument-and-observation-models">3. The <code>likelihood</code> argument and observation models<a class="anchor" aria-label="anchor" href="#the-likelihood-argument-and-observation-models"></a>
</h2>
<p>The terms <strong>observation model</strong> and
<strong>likelihood</strong> are used to refer to the same formula,
i.e. <span class="math inline">\(p(y_n \mid f(\textbf{x}_n),
\theta_{\text{obs}})\)</span>, though the former means it as a function
of <span class="math inline">\(\textbf{y}\)</span> and the latter as a
function of <span class="math inline">\(\theta\)</span>. There are
currently five observation models available and they all involve an
inverse link function transformation <span class="math display">\[
h_n = g^{-1}\left(  f(\textbf{x}_n)+ \hat{c}_n \right)
\]</span> where <span class="math inline">\(g\)</span> is determined by
the <code>likelihood</code> argument and <span class="math inline">\(\hat{c}_n\)</span> by the <code>c_hat</code>
argument. The below table shows what the link function is in different
cases, and what parameter the corresponding observation model has.</p>
<table class="table">
<thead><tr class="header">
<th><code>likelihood</code></th>
<th>Link function <span class="math inline">\(g\)</span>
</th>
<th>Parameter <span class="math inline">\(\theta_{\text{obs}}\)</span>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>gaussian</code></td>
<td>identity</td>
<td><span class="math inline">\(\sigma\)</span></td>
</tr>
<tr class="even">
<td><code>poisson</code></td>
<td>logarithm</td>
<td>-</td>
</tr>
<tr class="odd">
<td><code>nb</code></td>
<td>logarithm</td>
<td><span class="math inline">\(\phi\)</span></td>
</tr>
<tr class="even">
<td><code>binomial</code></td>
<td>logit</td>
<td>-</td>
</tr>
<tr class="odd">
<td><code>bb</code></td>
<td>logit</td>
<td><span class="math inline">\(\gamma\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li><p>In the <strong>Gaussian</strong> observation model
(<code>likelihood="gaussian"</code>), <span class="math display">\[
p(y_n \mid f(\textbf{x}_n), \theta_{\text{obs}}) = \mathcal{N}(y_n \mid
h_n, \sigma^2)
\]</span> <span class="math inline">\(\theta_{\text{obs}}=\sigma\)</span> is a noise
magnitude parameter.</p></li>
<li><p>The <strong>Poisson</strong> observation model
(<code>likelihood="poisson"</code>) for count data is <span class="math display">\[
y_n \sim \text{Poisson}\left(\lambda_n \right),
\]</span> where the rate is <span class="math inline">\(\lambda_n =
h_n\)</span>.</p></li>
<li><p>In the <strong>negative binomial</strong>
(<code>likelihood="nb"</code>) model, <span class="math inline">\(\lambda_n\)</span> is gamma-distributed with
parameters <span class="math display">\[
\begin{cases}
\text{shape} &amp;= \phi \\
\text{scale} &amp;= \frac{\phi}{h_n}
\end{cases},
\]</span> and <span class="math inline">\(\phi &gt; 0\)</span> controls
overdispersion so that <span class="math inline">\(\phi \rightarrow
\infty\)</span> corresponds to the Poisson model.</p></li>
<li><p>When selecting the binomial or beta-binomial observation model
for count data, the number of trials <span class="math inline">\(\eta_n\)</span>, for each <span class="math inline">\(n=1, \ldots, N\)</span> has to be supplied using
the <code>num_trials</code> argument. The <strong>binomial</strong>
model (<code>likelihood="binomial"</code>) is <span class="math display">\[
y_n \sim \text{Binomial}(h_n, \eta_n),
\]</span> where the success probability <span class="math inline">\(\rho_n = h_n\)</span>.</p></li>
<li><p>In the <strong>beta-binomial</strong> model
(<code>likelihood="bb"</code>), <span class="math inline">\(\rho_i\)</span> is random so that <span class="math display">\[
\rho_n \sim \text{Beta}\left(h_n \cdot \frac{1 - \gamma}{\gamma},
\  (1-h_n) \cdot \frac{1 - \gamma}{\gamma}\right),
\]</span> and the parameter <span class="math inline">\(\gamma \in [0,
1]\)</span> controls overdispersion so that <span class="math inline">\(\gamma \rightarrow 0\)</span> corresponds to the
binomial model.</p></li>
</ul>
<p>When using the Gaussian observation model with
<code>sample_f=TRUE</code> the continuous response <span class="math inline">\(y\)</span> is normalized to unit variance and zero
mean, and <span class="math inline">\(\hat{c}_n = 0\)</span> for all
<span class="math inline">\(n\)</span> is set. In this case the
<code>c_hat</code> argument has no effect. With
<code>sample_f = TRUE</code>, sensible defaults are used. See the
documentation of the <code>c_hat</code> argument of <code><a href="../reference/lgp.html">lgp()</a></code>
for exact details and the <a href="#model-inference">5. Model
inference</a> section for information about the <code>sample_f</code>
argument.</p>
</div>
<div class="section level2">
<h2 id="the-formula-argument-and-kernel-functions">4. The <code>formula</code> argument and kernel functions<a class="anchor" aria-label="anchor" href="#the-formula-argument-and-kernel-functions"></a>
</h2>
<div class="section level3">
<h3 id="additive-gp-regression">Additive GP regression<a class="anchor" aria-label="anchor" href="#additive-gp-regression"></a>
</h3>
<p>The GP models of <code>lgpr</code> are additive, so that <span class="math display">\[\begin{equation}
k(\textbf{x}, \textbf{x}' \mid \theta_{\text{GP}})  = \sum_{j=1}^J
\alpha_j^2 k_j(\textbf{x}, \textbf{x}' \mid \theta_{\text{GP}}).
\end{equation}\]</span> This is equivalent to saying that we have <span class="math inline">\(f = f^{(1)} + \ldots + f^{(J)}\)</span> modeled so
that each component <span class="math inline">\(j = 1, \ldots,
J\)</span> has a GP prior <span class="math display">\[\begin{equation}
f^{(j)} \sim \mathcal{GP}\left(0, \alpha_j^2 k_j(\textbf{x},
\textbf{x}' \mid \theta_{\text{GP}}) \right),
\end{equation}\]</span> independently from other components.</p>
</div>
<div class="section level3">
<h3 id="formulas-and-terms">Formulas and terms<a class="anchor" aria-label="anchor" href="#formulas-and-terms"></a>
</h3>
<p>The number of components <span class="math inline">\(J\)</span> is
equal to the number of terms in your <code>formula</code>. Terms are
separated by a plus sign. An example formula with three terms could
be</p>
<pre><code><span><span class="va">y</span> <span class="op">~</span> <span class="fu">gp</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="fu">gp</span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">*</span><span class="fu">zs</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu">categ</span><span class="op">(</span><span class="va">group</span><span class="op">)</span></span></code></pre>
<p>where <code>y</code>, <code>age</code>, <code>id</code> and
<code>group</code> have to be columns of <code>data</code>. Each formula
term defines what the corresponding kernel <span class="math inline">\(k_j\)</span> will be like, and what covariates and
parameters it depends on. Each term adds one <span class="math inline">\(\alpha\)</span> parameter in the GP parameter
vector <span class="math inline">\(\theta_{\text{GP}}\)</span>, and
possible additional parameters depending on the term.</p>
</div>
<div class="section level3">
<h3 id="expressions-and-kernels">Expressions and kernels<a class="anchor" aria-label="anchor" href="#expressions-and-kernels"></a>
</h3>
<p>Each term is a product (separated by <code>*</code>) of what we call
expressions. At this point we are not using standard R formula
terminology because terms in <code>lgpr</code> are parsed in a custom
way. Each expression corresponds to one kernel, and the kernel <span class="math inline">\(k_j\)</span> is the product of all the kernels in
term <span class="math inline">\(j\)</span>. Inside parentheses, each
expression must contain the name of one <code>data</code> variable, as
in <code>gp(age)</code>. This determines what variable the kernel
depends on. Most of the allowed expressions, their corresponding
kernels, and allowed variable types are listed below.</p>
<table class="table">
<thead><tr class="header">
<th>Expression</th>
<th>Corresponding kernel</th>
<th>Allowed variable type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>gp()</code></td>
<td>Exponentiated quadratic (EQ)</td>
<td>Continuous</td>
</tr>
<tr class="even">
<td><code>zs()</code></td>
<td>Zero-sum (ZS)</td>
<td>Categorical</td>
</tr>
<tr class="odd">
<td><code>categ()</code></td>
<td>Categorical (CAT)</td>
<td>Categorical</td>
</tr>
<tr class="even">
<td><code>gp_ns()</code></td>
<td>Nonstationary (NS)</td>
<td>Continuous</td>
</tr>
<tr class="odd">
<td><code>gp_vm()</code></td>
<td>Variance-mask (VM)</td>
<td>Continuous</td>
</tr>
</tbody>
</table>
<p>Continuous covariates should be represented in <code>data</code> as
<code>numeric</code> and categorical covariates as <code>factor</code>s.
Equations for different kernels are listed here briefly. See <span class="citation">Timonen et al. (2021)</span> for more motivation and
details about what kind of effects they can model alone and in
combinations.</p>
<ul>
<li><p>The EQ kernel is <span class="math display">\[
k_{\text{EQ}}(x,x' \mid \theta_{\text{GP}}) = \exp \left(
-\frac{(x-x')^2}{2 \ell^2}\right)
\]</span> and it has the lengthscale parameter <span class="math inline">\(\ell\)</span>. Each EQ kernel adds one lengthscale
parameter to <span class="math inline">\(\theta_{\text{GP}}\)</span>.</p></li>
<li><p>The ZS kernel is <span class="math display">\[\begin{equation}
  k_{\text{ZS}}(z, z') =
  \begin{cases} 1 \ \ \ \text{   if   } z = z' \\
  \frac{1}{1 - M} \ \ \ \text{   if   } z \neq z'
  \end{cases}
\end{equation}\]</span> where <span class="math inline">\(M\)</span> is
the number of different categories for covariate <span class="math inline">\(z\)</span>.</p></li>
<li><p>The CAT kernel is <span class="math display">\[\begin{equation}
  k_{\text{CAT}}(z, z') =
  \begin{cases} 1 \ \ \ \text{   if   } z = z' \\
  0 \ \ \ \text{   if   } z \neq z'
  \end{cases}
\end{equation}\]</span></p></li>
<li><p>The NS kernel is <span class="math display">\[\begin{equation}
  k_{\text{NS}}(x, x' \mid a, \ell) =  k_{\text{EQ}}(\omega_a(x),
\omega_a(x') \mid \ell),
\end{equation}\]</span> where <span class="math inline">\(\omega_a:
\mathbb{R} \rightarrow ]-1,1[\)</span> is an input warping function
<span class="math display">\[\begin{equation}
  \omega_a(x) = 2 \cdot \left(\frac{1}{1 + e^{-a x}} - \frac{1}{2}
\right),
\end{equation}\]</span> Each NS kernel adds one lengthscale parameter
<span class="math inline">\(\ell\)</span> and one warping steepness
parameter <span class="math inline">\(a\)</span> to <span class="math inline">\(\theta_{\text{GP}}\)</span>.</p></li>
<li><p>The VM kernel is <span class="math display">\[\begin{equation}
  k_{\text{VM}}(x, x' \mid a, \ell) = f^a_{\text{VM}}(x)
\cdot  f^a_{\text{VM}}(x') \cdot k_{\text{NS}}(x, x' \mid a,
\ell),
\end{equation}\]</span> where <span class="math inline">\(f^a_{\text{VM}}(x) = \frac{1}{1 + e^{-a h_2
(x-r)}}\)</span> and <span class="math inline">\(r = \frac{1}{a}
\text{logit}(h_1)\)</span>. The parameters <span class="math inline">\(h_1\)</span> and <span class="math inline">\(h_2\)</span> are determined by
<code>opt$vm_params[1]</code> and <code>opt$vm_params[2]</code>,
respectively, where <code>opt</code> is the <code>options</code>
argument given to <code><a href="../reference/lgp.html">lgp()</a></code>. Each VM kernel adds one
lengthscale parameter <span class="math inline">\(\ell\)</span> and one
warping steepness parameter <span class="math inline">\(a\)</span> to
<span class="math inline">\(\theta_{\text{GP}}\)</span>.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="masking-missing-covariates">Masking missing covariates<a class="anchor" aria-label="anchor" href="#masking-missing-covariates"></a>
</h3>
<p>All kernels that work with continuous covariates are actually also
multiplied by a binary mask (BIN) kernel <span class="math inline">\(k_{\text{BIN}}(x,x')\)</span> which returns
<span class="math inline">\(0\)</span> if either <span class="math inline">\(x\)</span> or <span class="math inline">\(x'\)</span> is missing and <span class="math inline">\(1\)</span> if they are both available. Missing
data should be encoded as <code>NA</code> or <code>NaN</code> in
<code>data</code>.</p>
</div>
<div class="section level3">
<h3 id="heterogeneous-effects-and-covariate-uncertainty">Heterogeneous effects and covariate uncertainty<a class="anchor" aria-label="anchor" href="#heterogeneous-effects-and-covariate-uncertainty"></a>
</h3>
<p>There are also the <code>het()</code> and <code>unc()</code>
expressions. They cannot be alone in a term but have to be multiplied by
EQ, NS or VM. They are not actually kernels alone but edit the covariate
or kernel of their term and add additional parameters. See the tutorials
for example use cases and <span class="citation">Timonen et al.
(2021)</span> for their mathematical definition.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-inference">5. Model inference<a class="anchor" aria-label="anchor" href="#model-inference"></a>
</h2>
<p>After the model is defined, <code>lgpr</code> uses the MCMC methods
of Stan to obtain draws from the joint posterior <span class="math inline">\(p\left(\theta, \textbf{f} \mid
\mathcal{D}\right)\)</span> or the marginal posterior of parameters,
i.e.  <span class="math inline">\(p\left(\theta \mid
\mathcal{D}\right)\)</span>. Which one of these is done is determined by
the <code>sample_f</code> argument of <code><a href="../reference/lgp.html">lgp()</a></code> or
<code><a href="../reference/create_model.html">create_model()</a></code>.</p>
<div class="section level3">
<h3 id="with-sample_f-true">With sample_f = TRUE<a class="anchor" aria-label="anchor" href="#with-sample_f-true"></a>
</h3>
<p>This option is always possible but not recommended with
<code>likelihood = "gaussian"</code>. The joint posterior that is
sampled from is <span class="math display">\[\begin{equation}
p\left(\theta, \textbf{f} \mid \mathcal{D}\right) \propto p\left(\theta,
\textbf{f}\right) \cdot p(\textbf{y} \mid \textbf{f}, \theta) \\
\end{equation}\]</span> and sampling requires evaluating the right-hand
side and its gradient thousands of times.</p>
</div>
<div class="section level3">
<h3 id="with-sample_f-false">With sample_f = FALSE<a class="anchor" aria-label="anchor" href="#with-sample_f-false"></a>
</h3>
<p>This option is only possible (and is automatically selected by
default) if <code>likelihood = "gaussian"</code>. This is because <span class="math display">\[\begin{equation}
p\left(\textbf{y} \mid \theta\right) = \mathcal{N}\left(\textbf{y} \mid
\textbf{0}, \textbf{K} + \sigma^2 \textbf{I} \right)
\end{equation}\]</span> is analytically available only in this case. The
distribution that is sampled from is <span class="math display">\[\begin{equation}
p\left(\theta \mid \mathcal{D}\right) \propto p\left(\theta\right) \cdot
p(\textbf{y} \mid \theta) \\
\end{equation}\]</span> and now sampling requires repeatedly evaluating
the right-hand side of this equation and its gradient. This analytical
marginalization reduces the MCMC dimension by <span class="math inline">\(N\)</span> and likely improves sampling
efficiency. The conditional posterior <span class="math inline">\(p\left(\textbf{f} \mid \theta,
\mathcal{D}\right)\)</span> also has an analytical form for a fixed
<span class="math inline">\(\theta\)</span>, so draws from the marginal
posterior <span class="math inline">\(p\left(\textbf{f} \mid
\mathcal{D}\right)\)</span> could be obtained by first drawing <span class="math inline">\(\theta\)</span> and then <span class="math inline">\(\textbf{f}\)</span>, according to the process
<span class="math display">\[\begin{align}
\theta &amp;\sim p\left(\theta \mid \mathcal{D}\right) \\
\textbf{f} &amp; \sim p\left(\textbf{f} \mid \theta, \mathcal{D}\right).
\end{align}\]</span> By combining these, we again have draws from the
joint posterior <span class="math inline">\(p\left(\theta, \textbf{f}
\mid \mathcal{D}\right)\)</span>, but likely with less computational
effort.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-timonen2021" class="csl-entry">
Timonen, Juho, Henrik Mannerström, Aki Vehtari, and Harri Lähdesmäki.
2021. <span>“Lgpr: An Interpretable Non-Parametric Method for Inferring
Covariate Effects from Longitudinal Data.”</span>
<em>Bioinformatics</em> 37 (13): 1860–67. <a href="https://doi.org/10.1093/bioinformatics/btab021" class="external-link">https://doi.org/10.1093/bioinformatics/btab021</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Juho Timonen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
